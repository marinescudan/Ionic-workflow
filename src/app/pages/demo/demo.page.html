<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button [defaultHref]="'/chapters/' + chapterId"></ion-back-button>
    </ion-buttons>
    <ion-title>
      {{ chapter?.title || 'Live Demos' }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="demo-page-container">

    <!-- Demo Selector (if multiple demos) -->
    @if (demos.length > 1) {
      <div class="demo-selector">
        <ion-segment
          [value]="selectedDemo?.id"
          (ionChange)="selectDemo(demoService.getDemoById($any($event).detail.value)!)"
          scrollable
        >
          @for (demo of demos; track demo.id) {
            <ion-segment-button
              [value]="demo.id"
            >
              <ion-icon [name]="demo.icon"></ion-icon>
              <ion-label>{{ demo.name }}</ion-label>
            </ion-segment-button>
          }
        </ion-segment>
      </div>
    }

    <!-- Component Playground -->
    @if (selectedDemo) {
      <app-component-playground
        [demoComponent]="selectedDemo"
      ></app-component-playground>
    }

    <!-- Empty State -->
    @if (demos.length === 0) {
      <div class="empty-state">
        <ion-icon name="alert-circle" color="medium"></ion-icon>
        <h2>No Demos Available</h2>
        <p>This chapter doesn't have interactive demos yet.</p>
        <p>Check back later or explore other chapters!</p>
      </div>
    }


    <!-- Navigation Demos (only for Chapter 6) -->
    @if (chapterId === 6) {
      <div class="navigation-demos">
        <h2>Navigation Patterns</h2>

        <ion-card>
          <ion-card-header>
            <ion-card-title>NavController Methods</ion-card-title>
            <ion-card-subtitle>Stack-based navigation with native animations</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-button expand="block" (click)="navigateForward()">
              <ion-icon name="arrow-forward" slot="start"></ion-icon>
              Navigate Forward
            </ion-button>
            <ion-button expand="block" (click)="navigateBack()">
              <ion-icon name="arrow-back" slot="start"></ion-icon>
              Navigate Back
            </ion-button>
            <ion-button expand="block" (click)="navigateRoot()">
              <ion-icon name="home" slot="start"></ion-icon>
              Navigate Root
            </ion-button>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-header>
            <ion-card-title>Modal Examples</ion-card-title>
            <ion-card-subtitle>Overlay patterns for focused tasks</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-button expand="block" (click)="openSimpleModal()">
              Simple Modal
            </ion-button>
            <ion-button expand="block" (click)="openFormModal()">
              Form Modal (Bottom Sheet)
            </ion-button>
            <ion-button expand="block" (click)="openFullpageModal()">
              Full-Page Modal
            </ion-button>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-header>
            <ion-card-title>Tab Navigation</ion-card-title>
            <ion-card-subtitle>Bottom tab navigation pattern</ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p>Navigate to tabs to see tab navigation in action.</p>
            <ion-button expand="block" routerLink="/tabs/home">
              Open Tabs
            </ion-button>
          </ion-card-content>
        </ion-card>
      </div>
    }

    <!-- Marble Diagram Example (only for Chapter 5) -->
    @if (chapterId === 5) {
      <div class="marble-section">
        <h2>Marble Diagram: map(x => x * 2)</h2>
        <app-marble-diagram
          [inputStream]="mapExample.input"
          [outputStream]="mapExample.output"
          operatorName="map(x => x * 2)"
        ></app-marble-diagram>
      </div>
    }

    <!-- Common Patterns (only for Chapter 6) -->
    @if (chapterId === 5 && patterns.length > 0) {
      <div class="patterns-section">
        <h2>Common RxJS Patterns</h2>

        <ion-card *ngFor="let pattern of patterns" class="pattern-card">
          <ion-card-header>
            <ion-card-title>{{ pattern.name }}</ion-card-title>
            <ion-card-subtitle>{{ pattern.description }}</ion-card-subtitle>
          </ion-card-header>

          <ion-card-content>
            <p class="use-case">
              <strong>Use Case:</strong> {{ pattern.useCase }}
            </p>

            <app-code-snippet
              [code]="pattern.code"
              language="typescript"
              [title]="pattern.name"
              [copyable]="true"
            ></app-code-snippet>

            <div class="explanation">
              <strong>Explanation:</strong>
              <pre>{{ pattern.explanation }}</pre>
            </div>

            <div class="warning" *ngIf="pattern.avoidCommonMistake">
              <ion-icon name="warning" color="warning"></ion-icon>
              {{ pattern.avoidCommonMistake }}
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    }

  </div>
</ion-content>
